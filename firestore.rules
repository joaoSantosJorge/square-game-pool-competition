service cloud.firestore {
  match /databases/{database}/documents {
    
    // Scores collection - anyone can read, ONLY Cloud Functions can write
    match /scores/{scoreId} {
      // Allow read of all documents (frontend will not display ipAddress)
      allow read: if true;
      
      // DENY all direct writes from clients - must go through Cloud Function
      allow create, update, delete: if false;
    }
    
    // Cycle state - anyone can read, only Cloud Functions can write
    match /cycleState/{document} {
      allow read: if true;
      allow write: if false; // Only backend/Cloud Functions can modify
    }
    
    // Cycle Metadata - anyone can read, only Cloud Functions can write
    match /cycleMetadata/{document} {
      allow read: if true;
      allow write: if false; // Only backend/Cloud Functions can modify
    }
    
    // User Profiles - anyone can read, only Cloud Functions can write
    match /userProfiles/{userId} {
      allow read: if true;
      allow write: if false; // Only backend/Cloud Functions can modify
    }
    
    // Payments - anyone can read, only Cloud Functions can write
    match /payments/{paymentId} {
      allow read: if true;
      allow write: if false; // Only backend/Cloud Functions can modify
    }
    
    // Archived score collections with wildcard pattern - anyone can read
    match /{archiveCollection}/{scoreId} {
      allow read: if archiveCollection.matches('scores_.*_to_.*');
      allow write: if false; // Only backend/Cloud Functions can modify
    }
    
    // Deny everything else by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
