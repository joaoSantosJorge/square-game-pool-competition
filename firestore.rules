service cloud.firestore {
  match /databases/{database}/documents {
    
    // Scores collection - anyone can read, only authenticated users can write their own score
    match /scores/{scoreId} {
      allow read: if true;
      allow create: if request.auth != null 
                    && request.resource.data.walletAddress == request.auth.token.walletAddress;
      allow update, delete: if false; // Scores are immutable once created
    }
    
    // Cycle state - anyone can read, only Cloud Functions can write
    match /cycleState/{document} {
      allow read: if true;
      allow write: if false; // Only backend/Cloud Functions can modify
    }
    
    // Deny everything else by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
